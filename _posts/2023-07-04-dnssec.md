---
layout: post
title: DNSSEC
categories: dns
excerpt: DNSSEC (Domain Name System Security Extensions) adds a layer of protection to DNS by using digital signatures. It helps to ensure that the information received when making DNS queries is genuine. In simple terms, DNSSEC helps mitigate MITM attacks.
---

This post builds upon the previous post on [DNS infrastructure](../2023-06-30-dns-infrastructure.md).

DNSSEC (Domain Name System Security Extensions) adds a layer of protection to DNS by using digital signatures. It helps to ensure that the information received when making DNS queries is genuine.

In simple terms, DNSSEC helps mitigate MITM attacks.


<br>

### Set Up the `ukadike2023.edu` Server

#### Generate keys for the `ukadike2023.edu` server
Two pairs of keys are generated; with each key consisting of a public key and a private key.

- create a folder called keys `mkdir /etc/bind/keys` and generate the DNS Keys in this directory

- Zone Signing Key (ZSK) used to sign the zone records
  `dnssec-keygen -a RSASHA256 -b 1024 ukadike2023.edu.`

- Key Signing Key (KSK) used to sign the ZSK.
  `dnssec-keygen -a RSASHA256 -b 2048 -f KSK ukadike2023.edu.`

#### Sign the `ukadike2023.edu` domain’s zone file
- navigate to `/etc/bind/zones` and sign the zone file
- `dnssec-signzone -e 20501231000000 -K ../keys/ -S -o ukadike2023.edu. ukadike2023.edu`
- edit `/etc/bind/named.conf.zones`
  
  ```
  zone "ukadike2023.edu." {
    type master;
    file "/etc/bind/zones/ukadike2023.edu.signed";
  };
  ```

- restart the nameserver service `service named restart` or reload the configuration file using `rnsc reconfig`

#### Testing the configuration

***`$ dig @10.162.0.73 ukadike2023.edu DNSKEY +dnssec`***

![01](https://github.com/iukadike/iukadike.github.io/assets/58455326/7fd09696-9f9c-48ea-aca4-635335e6f8c3)

The "IN DNSKEY" record is a response that contains the KSK and RSK for the ukadike2023.edu domain that was generated and used to sign the zone file.

The "IN RRSIG" record is a response that contains the individual signatures for the requested resource

***`$ dig @10.162.0.73 ukadike2023.edu NS +dnssec`***

![02](https://github.com/iukadike/iukadike.github.io/assets/58455326/19af0586-cea6-4b16-ac8f-0597ea93f338)

The answer section provides the nameserver for `ukadike2023.edu` plus the signature for the record

The additional section provides the IP address for the nameserver provided in the answer section plus the signature for the record

***`$ dig @10.162.0.73 www.ukadike2023.edu A +dnssec`***

![03](https://github.com/iukadike/iukadike.github.io/assets/58455326/3eada1b6-71e5-47e9-98fb-e1eb78e07716)

The answer section provides the IP address for `ukadike2023.edu` plus the signature for the record

<br>

### Set Up the edu Server

#### Generate keys for the edu server

Just like was done on the `ukadike2023.edu` nameserver, two pairs of keys will be generated on the edu TLD nameserver

- create a folder called keys `mkdir /etc/bind/keys` and generate the DNS Keys in this directory

- Zone Signing Key (ZSK) used to sign the zone records
  `dnssec-keygen -a RSASHA256 -b 1024 edu.`

- Key Signing Key (KSK) used to sign the ZSK.
  `dnssec-keygen -a RSASHA256 -b 2048 -f KSK edu.`

#### Sign the edu domain’s zone file

However, before signing the zone file, we need to add an entry to it. The entry is the DS record that was created on the `ukadike2023.edu` nameserver when we signed the zone file. A DS (Delegation Signer) record holds the name of a delegated zone and references a DNSKEY record in the sub-delegated zone.

- create a new folder called dssets `mkdir /etc/bind/dssets`
- copy the DS record created on `ukadike2023.edu` server to `/etc/bind/dssets/dsset-ukadike2023.edu` on the edu TLD server
- navigate to `/etc/bind/zones`, edit the zone file, and add the following:
  - `$INCLUDE ../dssets/dsset-ukadike2023.edu`
- navigate to `/etc/bind/zones` and sign the zone file
  - `dnssec-signzone -e 20501231000000 -K ../keys/ -S -o edu. edu`
- edit `/etc/bind/named.conf.zones`
  
  ```
  zone "edu." {
    type master;
    file "/etc/bind/zones/edu.signed";
  };
  ```

- restart the nameserver service `service named restart` or reload the configuration file using `rnsc reconfig`

#### Testing the configuration

***`$ dig @10.152.0.71 edu DNSKEY +dnssec`***

![04](https://github.com/iukadike/iukadike.github.io/assets/58455326/d591e44a-1772-41fa-92dc-edb06b1e915f)

The "IN DNSKEY" record is a response that contains the KSK and RSK for the edu domain that were generated and used to sign the zone file.

The "IN RRSIG" record is a response that contains the individual signatures for the requested DNSKEY resource

***`$ dig @10.152.0.71 edu NS +dnssec`***

![05](https://github.com/iukadike/iukadike.github.io/assets/58455326/fc98fa53-919f-4384-b7ee-3d9cbb5fd602)

The answer section provides the nameserver for `edu` plus the signature for the NS record

The additional section provides the IP address for the nameserver provided in the answer section plus the signature for the `A` record

***`$ dig @10.152.0.71 ukadike2023.edu +dnssec`***

![06](https://github.com/iukadike/iukadike.github.io/assets/58455326/2fc0526a-7834-4acb-906c-21142876ab4b)

The "IN NS" record is a response that contains the authoritative nameserver for `ukadike2023.edu` plus the signature for the `NS` record

The "IN DS" record is a response that contains the Delegation Signer record that was created when the `ukadike2023.edu` zone file was signed

The "IN RRSIG" is a response that contains the signature for the DS record

<br>

### Set Up the root Server

#### Generate keys for the root server
Just like was done on the edu TLD nameserver, two pairs of keys will be generated on the root nameserver

- create a folder called keys `mkdir /etc/bind/keys` and generate the DNS Keys in this directory

- Zone Signing Key (ZSK) used to sign the zone records
  `dnssec-keygen -a RSASHA256 -b 1024 .`

- Key Signing Key (KSK) used to sign the ZSK.
  `dnssec-keygen -a RSASHA256 -b 2048 -f KSK .`

#### Sign the root zone file

However, before signing the zone file, we need to add an entry to it. The entry is the DS record that was created on the edu nameserver when we signed the zone file.

- create a new folder called dssets `mkdir /etc/bind/dssets`
- copy the DS record created on the edu server to `/etc/bind/dssets/dsset-edu` on the root server
- navigate to `/etc/bind/zones`, edit the zone file, and add the following:
  `- $INCLUDE ../dssets/dsset-edu`
- navigate to `/etc/bind/zones` and sign the zone file
  - `dnssec-signzone -e 20501231000000 -K ../keys/ -S -o . root`
- edit `/etc/bind/named.conf.zones`
  
  ```
  zone "edu." {
    type master;
    file "/etc/bind/zones/root.signed";
  };
  ```

- restart the nameserver service `service named restart` or reload the configuration file using `rnsc reconfig`

#### Testing the configuration

***`$ dig @10.150.0.72 . DNSKEY +dnssec`***

![07](https://github.com/iukadike/iukadike.github.io/assets/58455326/0fd69df7-6eb1-4d8b-b53a-1ed7564f8db5)

The answer section provides the KSK and RSK for the root server that were generated and used to sign the zone file, plus the signatures of the KSK and RSK records.

***`$ dig @10.150.0.72 . NS +dnssec`***

![08](https://github.com/iukadike/iukadike.github.io/assets/58455326/a6ce45cf-64ff-4e39-b9fb-7550667806dd)

The answer section provides the nameserver for the root server plus the signature for the `NS` record 

***`$ dig @10.150.0.72 edu +dnssec`***

![09](https://github.com/iukadike/iukadike.github.io/assets/58455326/22bc10b9-a3d7-4076-8262-eca26748489d)

The authority section contains the nameserver for the edu TLD, the  Delegation Signer record that was created when the `edu` zone file was signed, plus the signature of the DS record

***`$ dig @10.150.0.72 ukadike2023.edu +dnssec`***

![10](https://github.com/iukadike/iukadike.github.io/assets/58455326/f1c47dc8-a047-4f2a-af83-6c94bbe3a482)

The authority section contains the nameserver for the edu TLD, the  Delegation Signer record that was created when the `edu` zone file was signed, plus the signature of the DS record. The result is the same as the above because the root server does not have information about `ukadike2023.edu` and must contact the edu TLD.

<br>

###  Set Up the Local DNS Server

Since the root server does not have a parent zone, the root servers’ public keys are the root of trust. Trust anchors are the way DNS resolvers obtain the root servers' keys in a secure way.

- BIND 9 built-in DNSSEC trust anchors can be overridden by the content inside `/etc/bind/bind.keys`. In this lab, we will put the root server’s KSK public key into this file. 

  ```
  trust-anchors {
    . static-key 257 3 8 " <root nameserver KSK> ";
  };
  ```

- Next enable DNSSEC validation in named.conf.options

  ```
  dnssec-validation auto;
  ```

- restart the nameserver service `service named restart` or reload the configuration file using `rnsc reconfig`

#### Testing the configuration

***`$ dig www.ukadike2023.edu +dnssec`***

![11](https://github.com/iukadike/iukadike.github.io/assets/58455326/78b60f1b-4142-4af1-ada4-1f7ecf87df41)

The answer section contains the authoritative answer to the request made plus the signature of the `A Record` received.

#### Testing a fake response

***`$ dig www.ukadike2023.edu`***

![12](https://github.com/iukadike/iukadike.github.io/assets/58455326/1664614d-ff8c-4d15-81f4-c8d557a38348)

when the record is forged (meaning the resolver cannot verify the signature associated with the record), the resolver reports a server failure.

<br>

_Thanks for reading_